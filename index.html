<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Jornada PRO NAVANTIA Ferrol</title>

<link rel="manifest" href="manifest.json">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">  

<link rel="manifest" href="manifest.json">
<link rel="stylesheet" href="styles.css">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script type="module" src="app.js"></script>
</head>

<body>

<header class="header">
  <h1 class="header-title">Jornada Pro NAVANTIA (Ferrol)</h1>
  <img src="icons/logo-navantia.png" alt="NAVANTIA" class="header-logo">
  <button type="button" id="btnMenuConfig" class="header-menu-btn" aria-label="Menú configuración">
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
  </button>
</header>

<!-- Panel configuración (desplegable desde el menú) -->
<div id="configPanel" class="config-panel">
  <div class="config-panel-inner">
    <h2 class="config-panel-title">Configuración</h2>

    <div class="config-block">
      <label class="config-row">
        <span class="config-label">Jornada (min)</span>
        <input type="number" id="cfgJornada" class="config-input" min="1">
      </label>
      <label class="config-row">
        <span class="config-label">Aviso antes terminar (min)</span>
        <input type="number" id="cfgAviso" class="config-input" min="0">
      </label>
    </div>

    <div class="config-block">
      <label class="config-row">
        <span class="config-label">Tema</span>
        <select id="cfgTheme" class="config-input config-select">
          <option value="light">Claro</option>
          <option value="dark">Oscuro</option>
        </select>
      </label>
    </div>

    <div class="config-block config-block-turnos">
      <label class="config-row config-toggle-row">
        <input type="checkbox" id="cfgTrabajoTurnos" class="config-checkbox">
        <span class="config-label">Trabajo a turnos</span>
      </label>
      <div id="configTurnoWrap" class="config-turno-wrap" hidden>
        <label class="config-row">
          <span class="config-label">Turno</span>
          <select id="cfgTurno" class="config-input config-select">
            <option value="06-14">Mañana (06:00 – 14:00)</option>
            <option value="14-22">Tarde (14:00 – 22:00)</option>
            <option value="22-06">Noche (22:00 – 06:00)</option>
          </select>
        </label>
      </div>
    </div>

    <div class="config-block config-iniciales">
      <span class="config-block-label">Saldo previo (antes de usar la app)</span>
      <label class="config-row">
        <span class="config-label">Horas extra previas (h)</span>
        <input type="number" id="cfgHorasExtraPrevias" class="config-input" min="0" step="0.25" placeholder="0">
      </label>
      <label class="config-row">
        <span class="config-label">Exceso jornada previo (h)</span>
        <input type="number" id="cfgExcesoJornadaPrevias" class="config-input" min="0" step="0.25" placeholder="0">
      </label>
      <div class="config-row config-row-reset">
        <button type="button" id="resetSaldoPrevio" class="config-btn config-btn-reset">Resetear saldo previo</button>
      </div>
      <p class="config-hint">Se suman al total disponible del banco (independiente del año).</p>
    </div>

    <div class="config-block config-notificaciones">
      <label class="config-row config-toggle-row">
        <input type="checkbox" id="cfgNotificaciones" class="config-checkbox" checked>
        <span class="config-label">Notificaciones</span>
      </label>
      <p class="config-hint">Aviso previo y fin de jornada (incl. app en segundo plano).</p>
    </div>

    <div class="config-actions">
      <button type="button" id="guardarConfig" class="config-btn config-btn-primary">Guardar configuración</button>
    </div>

    <hr class="config-divider">

    <div class="config-actions">
      <button type="button" id="excel" class="config-btn">Exportar Excel</button>
      <button type="button" id="backup" class="config-btn">Backup</button>
      <label class="config-btn config-btn-file">
        Restaurar
        <input type="file" id="restore" class="config-file-input">
      </label>
    </div>
  </div>
  <div id="configPanelBackdrop" class="config-panel-backdrop" aria-hidden="true"></div>
</div>

<!-- REGISTRO DIARIO -->
<section class="card registro">

  <!-- FORMULARIO REGISTRO -->
  <div class="form-card registro-card">

    <h3 style="margin-top:0;">Registro Diario</h3>

    <!-- BOTONES INICIAR / FINALIZAR JORNADA -->
    <div class="jornada-acciones">
      <button type="button" id="iniciarJornada" class="btn-jornada btn-iniciar">
        Iniciar jornada
      </button>
      <div id="finalizarJornadaWrap" class="finalizar-slider-wrap">
        <div id="finalizarSliderTrack" class="finalizar-slider-track">
          <span class="finalizar-slider-text">Desliza para finalizar →</span>
          <div id="finalizarSliderThumb" class="finalizar-slider-thumb" role="button" tabindex="0" aria-label="Deslizar para finalizar jornada"></div>
        </div>
      </div>
    </div>

    <!-- FECHA + ENTRADA -->
    <div class="grid-2">

      <div class="floating-group">
        <input type="date" id="fecha" required>
        <label for="fecha">Fecha</label>
      </div>

      <div class="floating-group">
        <input type="time" id="entrada" required>
        <label for="entrada">Hora de entrada</label>
      </div>

    </div>

    <!-- SALIDA + AJUSTE -->
    <div class="grid-2">

      <div class="floating-group">
        <input type="time" id="salida">
        <label for="salida">Hora de salida real</label>
      </div>

      <div class="floating-group">
        <input type="number" id="minAntes" min="0">
        <label for="minAntes">Salir antes (minutos)</label>
      </div>

    </div>

    <!-- DISFRUTADAS -->
    <div class="floating-group">
      <input type="number" id="disfrutadas" min="0">
      <label for="disfrutadas">Horas disfrutadas (min)</label>
    </div>

    <!-- BOTONES -->
    <div class="acciones-row">

      <button type="button" id="guardar">
        Guardar
      </button>

      <button type="button" id="vacaciones">
        Vacaciones
      </button>

      <button type="button" id="eliminar" class="btn-danger">
        Eliminar
      </button>

    </div>

  </div>

  <!-- SALIDAS VISUALES -->
  <div class="salidas-card">
    <div class="salida-box">
      <span class="salida-label">Salida teórica</span>
      <strong id="salidaTeorica">--:--</strong>
    </div>

    <div class="salida-box">
      <span class="salida-label">Salida ajustada</span>
      <strong id="salidaAjustada">--:--</strong>
    </div>
  </div>

  <!-- PROGRESO -->
  <div class="progress-wrapper">
  <div id="barra"></div>
  <div id="progresoInside" class="progress-text-inside"></div>
</div>

<div id="resumenDia" class="resumen-dia">
  <div class="resumen-line">
    <span>Trabajado</span>
    <strong id="rTrabajado">--</strong>
  </div>

  <div class="resumen-line">
    <span>Extra</span>
    <strong id="rExtra">--</strong>
  </div>

  <div class="resumen-line" id="resumenExcesoWrap">
    <span>Exceso jornada</span>
    <strong id="rExceso">--</strong>
  </div>

  <div class="resumen-line">
    <span>Negativa</span>
    <strong id="rNegativa">--</strong>
  </div>
</div>
  
</section>
  
<!-- GRID PRINCIPAL -->
<section class="main-grid">

  <!-- CALENDARIO -->
  <div class="card calendar-card">

    <div class="cal-nav">
      <button id="prevMes">◀</button>
      <span id="mesAnioLabel"></span>
      <button id="nextMes">▶</button>
    </div>

    <div id="calendarGrid" class="calendar-grid"></div>

  </div>

  <!-- GRÁFICO LATERAL -->
  <div class="card chart-card">
    <canvas id="chart"></canvas>
  </div>

</section>

<!-- MÉTRICAS BANCO -->
<section class="card metrics">
  <div class="metrics-header">
    <label class="metrics-year-label" for="selectBankYear">Año</label>
    <select id="selectBankYear" class="metrics-year-select" aria-label="Año del banco de horas"></select>
  </div>

  <div class="metric metric-total">
    <span>Total disponible (acumulado)</span>
    <strong id="bTotalDisponible"></strong>
  </div>

  <div class="metric">
    <span>Extra (Anual)</span>
    <strong id="bGeneradas"></strong>
  </div>

  <div class="metric">
    <span>Exceso jornada (Anual)</span>
    <strong id="bExceso"></strong>
  </div>

  <div class="metric">
    <span>Negativas (Anual)</span>
    <strong id="bNegativas"></strong>
  </div>

  <div class="metric">
    <span>Disfrutadas (Anual)</span>
    <strong id="bDisfrutadas"></strong>
  </div>

  <div class="metric saldo">
    <span>Saldo Anual</span>
    <strong id="bSaldoAnual"></strong>
  </div>

  <div class="metric saldo">
    <span>Saldo Mensual</span>
    <strong id="bSaldo"></strong>
  </div>


</section>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./service-worker.js');
}
</script>  

</body>
</html>
